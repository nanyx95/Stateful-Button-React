{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "stateful-button",
  "type": "registry:component",
  "title": "Stateful Button",
  "author": "Fabio Somaglia",
  "description": "Stateful Button description.",
  "dependencies": [
    "xstate",
    "@xstate/react",
    "motion"
  ],
  "registryDependencies": [
    "button",
    "progress"
  ],
  "files": [
    {
      "path": "registry/new-york/ui/stateful-button/stateful-button.tsx",
      "content": "'use client';\n\nimport React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Check, X, LoaderCircle } from 'lucide-react';\nimport { assign, setup } from 'xstate';\nimport { useMachine } from '@xstate/react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\nimport { motion, AnimatePresence, useReducedMotion, type Transition } from 'motion/react';\n\nconst statefulButtonMachine = setup({\n\ttypes: {\n\t\tcontext: {} as {\n\t\t\tprogress: number;\n\t\t\tonComplete?: () => void;\n\t\t\tbuttonType: 'spinner' | 'progress';\n\t\t},\n\t\tinput: {} as {\n\t\t\tonComplete?: () => void;\n\t\t\tbuttonType: 'spinner' | 'progress';\n\t\t},\n\t\tevents: {} as\n\t\t\t| { type: 'click' }\n\t\t\t| { type: 'setProgress'; progress: number }\n\t\t\t| { type: 'finishLoading' }\n\t\t\t| { type: 'error' }\n\t},\n\tactions: {\n\t\tonComplete: ({ context }) => {\n\t\t\tcontext.onComplete?.();\n\t\t}\n\t},\n\tguards: {\n\t\tisSpinner: ({ context }) => context.buttonType === 'spinner',\n\t\tisProgress: ({ context }) => context.buttonType === 'progress'\n\t}\n}).createMachine({\n\tid: 'statefulButton',\n\tcontext: ({ input }) => ({\n\t\tprogress: 0,\n\t\tonComplete: input.onComplete,\n\t\tbuttonType: input.buttonType\n\t}),\n\tinitial: 'idle',\n\tstates: {\n\t\tidle: {\n\t\t\ton: {\n\t\t\t\tclick: [\n\t\t\t\t\t{ target: 'loading', guard: 'isSpinner' },\n\t\t\t\t\t{ target: 'progress', guard: 'isProgress' }\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\tloading: {\n\t\t\ton: {\n\t\t\t\tfinishLoading: { target: 'success' },\n\t\t\t\terror: { target: 'error' }\n\t\t\t}\n\t\t},\n\t\tprogress: {\n\t\t\ton: {\n\t\t\t\tsetProgress: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttarget: 'success',\n\t\t\t\t\t\tguard: ({ event }) => event.progress >= 100,\n\t\t\t\t\t\tactions: assign({\n\t\t\t\t\t\t\tprogress: ({ event }) => event.progress\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tactions: assign({\n\t\t\t\t\t\t\tprogress: ({ event }) => event.progress\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\terror: { target: 'error' }\n\t\t\t}\n\t\t},\n\t\tsuccess: {\n\t\t\tentry: 'onComplete',\n\t\t\tafter: {\n\t\t\t\t1500: {\n\t\t\t\t\ttarget: 'idle',\n\t\t\t\t\tactions: assign({ progress: 0 })\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\terror: {\n\t\t\tafter: {\n\t\t\t\t1500: {\n\t\t\t\t\ttarget: 'idle',\n\t\t\t\t\tactions: assign({ progress: 0 })\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\nconst buttonVariants = cva(\n\t'w-25 gap-1 relative overflow-hidden disabled:pointer-events-auto disabled:cursor-not-allowed disabled:opacity-100',\n\t{\n\t\tvariants: {\n\t\t\tsize: {\n\t\t\t\tdefault: 'h-9 px-3.5 py-2 has-[>svg]:px-3',\n\t\t\t\tsm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n\t\t\t\tlg: 'h-10 rounded-md px-4.5 has-[>svg]:px-4'\n\t\t\t}\n\t\t},\n\t\tdefaultVariants: {\n\t\t\tsize: 'default'\n\t\t}\n\t}\n);\n\nconst progressVariants = cva('', {\n\tvariants: {\n\t\tvariant: {\n\t\t\tdefault:\n\t\t\t\t'bg-neutral-50/20 dark:bg-neutral-900/20 [&>[data-slot=progress-indicator]]:bg-neutral-50 [&>[data-slot=progress-indicator]]:dark:bg-neutral-900',\n\t\t\tdestructive:\n\t\t\t\t'bg-neutral-900/20 dark:bg-neutral-50/20 [&>[data-slot=progress-indicator]]:bg-neutral-900 [&>[data-slot=progress-indicator]]:dark:bg-neutral-50',\n\t\t\toutline:\n\t\t\t\t'bg-neutral-900/20 dark:bg-neutral-50/20 [&>[data-slot=progress-indicator]]:bg-neutral-900 [&>[data-slot=progress-indicator]]:dark:bg-neutral-50',\n\t\t\tsecondary:\n\t\t\t\t'bg-neutral-900/20 dark:bg-neutral-50/20 [&>[data-slot=progress-indicator]]:bg-neutral-900 [&>[data-slot=progress-indicator]]:dark:bg-neutral-50',\n\t\t\tghost:\n\t\t\t\t'bg-neutral-900/20 dark:bg-neutral-50/20 [&>[data-slot=progress-indicator]]:bg-neutral-900 [&>[data-slot=progress-indicator]]:dark:bg-neutral-50'\n\t\t}\n\t},\n\tdefaultVariants: {\n\t\tvariant: 'default'\n\t}\n});\n\ntype BaseProps = {\n\tonClick?: (event: React.MouseEvent<HTMLButtonElement>) => void | Promise<unknown>;\n\tonComplete?: () => void;\n\tonError?: (error: Error) => void;\n\tchildren?: React.ReactNode;\n} & React.ButtonHTMLAttributes<HTMLButtonElement> &\n\tVariantProps<typeof buttonVariants> &\n\tVariantProps<typeof progressVariants>;\n\ntype SpinnerButtonProps = BaseProps & {\n\tbuttonType?: 'spinner';\n\tprogress?: never;\n};\n\ntype ProgressButtonProps = BaseProps & {\n\tbuttonType: 'progress';\n\tprogress: number;\n};\n\ntype AriaMessages = {\n\tloading?: string;\n\tprogress?: (value: number) => string;\n\tsuccess?: string;\n\terror?: string;\n};\n\nexport type StatefulButtonProps = BaseProps &\n\t(SpinnerButtonProps | ProgressButtonProps) & { ariaMessages?: AriaMessages };\n\nconst StatefulButton: React.FC<StatefulButtonProps> = ({\n\tbuttonType = 'spinner',\n\tonClick,\n\tonComplete,\n\tonError,\n\tprogress,\n\tchildren,\n\tclassName,\n\tvariant,\n\tsize,\n\tariaMessages,\n\t...props\n}) => {\n\tconst [snapshot, send] = useMachine(statefulButtonMachine, {\n\t\tinput: {\n\t\t\tonComplete,\n\t\t\tbuttonType\n\t\t}\n\t});\n\n\tconst shouldReduceMotion = useReducedMotion();\n\n\tReact.useEffect(() => {\n\t\tif (buttonType === 'progress' && typeof progress === 'number') {\n\t\t\tsend({ type: 'setProgress', progress });\n\t\t}\n\t}, [progress]);\n\n\tconst handleClick = async (event: React.MouseEvent<HTMLButtonElement>) => {\n\t\tsend({ type: 'click' });\n\t\ttry {\n\t\t\tawait onClick?.(event);\n\t\t\tif (buttonType === 'spinner') {\n\t\t\t\tsend({ type: 'finishLoading' });\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tconst err = error instanceof Error ? error : new Error(String(error));\n\t\t\tonError?.(err);\n\t\t\tsend({ type: 'error' });\n\t\t}\n\t};\n\n\tconst defaultAriaMessages: Required<AriaMessages> = {\n\t\tloading: 'Loading, please wait',\n\t\tprogress: (value: number) => {\n\t\t\tconst roundedValue = Math.round(value / 25) * 25;\n\t\t\treturn `${roundedValue}%`;\n\t\t},\n\t\tsuccess: 'Completed successfully',\n\t\terror: 'An error occurred'\n\t};\n\tconst ariaMsg = { ...defaultAriaMessages, ...ariaMessages };\n\n\tconst loadingContent = (\n\t\t<>\n\t\t\t<LoaderCircle className=\"animate-spin\" aria-hidden=\"true\" />\n\t\t\t<span className=\"sr-only\">{ariaMsg.loading}</span>\n\t\t</>\n\t);\n\tconst progressContent = (\n\t\t<>\n\t\t\t<Progress value={snapshot.context.progress} className={cn(progressVariants({ variant }))} />\n\t\t\t<span className=\"sr-only\">{ariaMsg.progress(snapshot.context.progress)}</span>\n\t\t</>\n\t);\n\tconst successContent = (\n\t\t<>\n\t\t\t<Check aria-hidden=\"true\" />\n\t\t\t<span role=\"status\" className=\"sr-only\">\n\t\t\t\t{ariaMsg.success}\n\t\t\t</span>\n\t\t</>\n\t);\n\tconst errorContent = (\n\t\t<>\n\t\t\t<X aria-hidden=\"true\" />\n\t\t\t<span role=\"status\" className=\"sr-only\">\n\t\t\t\t{ariaMsg.error}\n\t\t\t</span>\n\t\t</>\n\t);\n\n\tconst slideTransition: Transition = { duration: shouldReduceMotion ? 0.1 : 0.2, ease: 'easeOut' };\n\tconst fadeTransition: Transition = { duration: shouldReduceMotion ? 0.05 : 0.15, ease: 'linear' };\n\tconst reducedY = shouldReduceMotion ? 20 : 80;\n\n\treturn (\n\t\t<Button\n\t\t\tvariant={variant}\n\t\t\tclassName={cn(buttonVariants({ size, className }))}\n\t\t\tonClick={handleClick}\n\t\t\tdisabled={!snapshot.matches('idle')}\n\t\t\taria-busy={snapshot.matches('loading') || snapshot.matches('progress')}\n\t\t\taria-live=\"polite\"\n\t\t\t{...props}\n\t\t>\n\t\t\t<AnimatePresence mode=\"wait\" initial={false}>\n\t\t\t\t{snapshot.matches('idle') && (\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tkey=\"idle\"\n\t\t\t\t\t\tinitial={{ y: `-${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\tanimate={{ y: 0, opacity: 1 }}\n\t\t\t\t\t\texit={{ y: `-${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\ttransition={slideTransition}\n\t\t\t\t\t\tclassName=\"flex items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</motion.div>\n\t\t\t\t)}\n\n\t\t\t\t{snapshot.matches('loading') && (\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tkey=\"loading\"\n\t\t\t\t\t\tinitial={{ y: `${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\tanimate={{ y: 0, opacity: 1 }}\n\t\t\t\t\t\texit={{ opacity: 0 }}\n\t\t\t\t\t\ttransition={slideTransition}\n\t\t\t\t\t\tclassName=\"flex items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{loadingContent}\n\t\t\t\t\t</motion.div>\n\t\t\t\t)}\n\n\t\t\t\t{snapshot.matches('progress') && (\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tkey=\"progress\"\n\t\t\t\t\t\tinitial={{ y: `${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\tanimate={{ y: 0, opacity: 1 }}\n\t\t\t\t\t\texit={{ opacity: 0 }}\n\t\t\t\t\t\ttransition={slideTransition}\n\t\t\t\t\t\tclassName=\"flex w-full items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{progressContent}\n\t\t\t\t\t</motion.div>\n\t\t\t\t)}\n\n\t\t\t\t{snapshot.matches('success') && (\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tkey=\"success\"\n\t\t\t\t\t\tinitial={{ opacity: 0 }}\n\t\t\t\t\t\tanimate={{ opacity: 1 }}\n\t\t\t\t\t\texit={{ y: `${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\ttransition={fadeTransition}\n\t\t\t\t\t\tclassName=\"flex items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{successContent}\n\t\t\t\t\t</motion.div>\n\t\t\t\t)}\n\n\t\t\t\t{snapshot.matches('error') && (\n\t\t\t\t\t<motion.div\n\t\t\t\t\t\tkey=\"error\"\n\t\t\t\t\t\tinitial={{ opacity: 0 }}\n\t\t\t\t\t\tanimate={{ opacity: 1 }}\n\t\t\t\t\t\texit={{ y: `${reducedY}%`, opacity: 0 }}\n\t\t\t\t\t\ttransition={fadeTransition}\n\t\t\t\t\t\tclassName=\"flex items-center gap-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{errorContent}\n\t\t\t\t\t</motion.div>\n\t\t\t\t)}\n\t\t\t</AnimatePresence>\n\t\t</Button>\n\t);\n};\n\nexport default StatefulButton;\n",
      "type": "registry:component",
      "target": "~/components/ui/stateful-button.tsx"
    }
  ]
}